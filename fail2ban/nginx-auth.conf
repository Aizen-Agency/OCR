# Fail2ban filter for nginx authentication failures
# Detects 401 Unauthorized and 403 Forbidden responses

[Definition]
# Match 401 Unauthorized and 403 Forbidden responses
# Nginx log format: $remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent ...
# Example: 172.18.0.1 - - [17/Nov/2025:11:55:11 +0000] "GET /ocr/image HTTP/1.1" 401 150
failregex = ^<HOST> -.*"(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS) .*" (401|403) .*$

# Ignore successful requests and health checks
ignoreregex = ^.*"GET /health.*" (200|404) .*$

# Date pattern for nginx logs
# Standard nginx log format: 172.18.0.1 - - [17/Nov/2025:11:55:11 +0000] "GET /health/ready HTTP/1.1" 200 159
datepattern = \[%%d/%%b/%%Y:%%H:%%M:%%S %%z\]

