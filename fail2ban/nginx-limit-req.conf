# Fail2ban filter for nginx rate limit violations
# Detects 429 Too Many Requests responses (rate limit exceeded)

[Definition]
# Match 429 Too Many Requests responses (rate limit violations)
# Nginx log format: $remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent ...
# Example: 172.18.0.1 - - [17/Nov/2025:11:55:11 +0000] "GET /ocr/image HTTP/1.1" 429 150
failregex = ^<HOST> -.*"(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS) .*" 429 .*$

# Ignore successful requests and health checks
ignoreregex = ^.*"GET /health.*" (200|404) .*$

# Date pattern for nginx logs
# Standard nginx log format: 172.18.0.1 - - [17/Nov/2025:11:55:11 +0000] "GET /health/ready HTTP/1.1" 200 159
datepattern = \[%%d/%%b/%%Y:%%H:%%M:%%S %%z\]

